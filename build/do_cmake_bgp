#!/bin/sh

mpifc=mpif90
mpi_link_paths=`$mpifc -show | grep -o -- '\(^\| \)-L\([^\"[:space:]]\+\|\"[^\"[:space:]]\+\"\)'`
mpi_libs=`      $mpifc -show | grep -o -- '\(^\| \)-l\([^\"[:space:]]\+\|\"[^\"[:space:]]\+\"\)'`
mpi_link_args=` $mpifc -show | grep -o -- '\(^\| \)-Wl,\([^\"[:space:]]\+\|\"[^\"[:space:]]\+\"\)'`
MPI_LIBRARIES=`echo $mpi_link_paths $mpi_libs $mpi_link_args`   #get rid of newlines.

cmake \
    -D CMAKE_INSTALL_PREFIX=$HOME/opt/pnmpi/$SYS_TYPE \
    -D CMAKE_TOOLCHAIN_FILE=../cmakemodules/BlueGeneP-gnu.cmake \
    -D MPI_H_DIR=/bgsys/drivers/V1R4M2_200_2010-100508P/ppc/comm/default/include \
    -D MPI_LIBRARIES="$MPI_LIBRARIES" \
    ..
